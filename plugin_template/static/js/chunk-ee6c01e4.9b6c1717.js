(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee6c01e4"],{5319:function(e,t,a){"use strict";var s=a("d784"),i=a("825a"),n=a("7b0b"),r=a("50c4"),o=a("a691"),c=a("1d80"),l=a("8aa5"),d=a("14c3"),u=Math.max,p=Math.min,m=Math.floor,v=/\$([$&'`]|\d\d?|<[^>]*>)/g,h=/\$([$&'`]|\d\d?)/g,f=function(e){return void 0===e?e:String(e)};s("replace",2,(function(e,t,a,s){var g=s.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,b=s.REPLACE_KEEPS_$0,w=g?"$":"$0";return[function(a,s){var i=c(this),n=void 0==a?void 0:a[e];return void 0!==n?n.call(a,i,s):t.call(String(i),a,s)},function(e,s){if(!g&&b||"string"===typeof s&&-1===s.indexOf(w)){var n=a(t,e,this,s);if(n.done)return n.value}var c=i(e),m=String(this),v="function"===typeof s;v||(s=String(s));var h=c.global;if(h){var _=c.unicode;c.lastIndex=0}var S=[];while(1){var $=d(c,m);if(null===$)break;if(S.push($),!h)break;var y=String($[0]);""===y&&(c.lastIndex=l(m,r(c.lastIndex),_))}for(var A="",x=0,k=0;k<S.length;k++){$=S[k];for(var D=String($[0]),E=u(p(o($.index),m.length),0),U=[],I=1;I<$.length;I++)U.push(f($[I]));var j=$.groups;if(v){var L=[D].concat(U,E,m);void 0!==j&&L.push(j);var F=String(s.apply(void 0,L))}else F=C(D,m,E,U,j,s);E>=x&&(A+=m.slice(x,E)+F,x=E+D.length)}return A+m.slice(x)}];function C(e,a,s,i,r,o){var c=s+e.length,l=i.length,d=h;return void 0!==r&&(r=n(r),d=v),t.call(o,d,(function(t,n){var o;switch(n.charAt(0)){case"$":return"$";case"&":return e;case"`":return a.slice(0,s);case"'":return a.slice(c);case"<":o=r[n.slice(1,-1)];break;default:var d=+n;if(0===d)return t;if(d>l){var u=m(d/10);return 0===u?t:u<=l?void 0===i[u-1]?n.charAt(1):i[u-1]+n.charAt(1):t}o=i[d-1]}return void 0===o?"":o}))}}))},"846e":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("h2",[e._v("Betreuerdaten")]),a("div",{staticClass:"alert alert-success",attrs:{role:"alert"}},[e._v("Bitte wählen Sie hier einen wissenschaftlichen Betreuer für Ihre PA II / PA III und geben Sie die Kontaktdaten Ihres Unternehmensbetreuers an.")]),e._l(e.courses,(function(t){return a("table",{key:t.id,staticClass:"table"},[e._m(0,!0),a("tbody",e._l(t.assignments,(function(t){return a("tr",{key:t.id},[a("td",[e._v(e._s(e.getType(t.name)))]),a("td",[e._v(e._s(new Date(1e3*parseInt(t.duedate)).toLocaleDateString()))]),e._m(1,!0),a("td",[a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(a){return e.changeData(t)}}},[e._v("Daten ändern")])])])})),0)])})),a("div",{ref:"modalStudents",staticClass:"modal fade",attrs:{id:"modalStudents",tabindex:"-1",role:"dialog","aria-labelledby":"modalStudents","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[e._m(2),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"container"},[a("form",[a("h6",[e._v("Unternehmensbetreuer")]),a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-md-4 mb-3"},[a("label",{attrs:{for:"validationServer01"}},[e._v("Vorname")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newCombination.corporateFirst,expression:"newCombination.corporateFirst"}],staticClass:"form-control",class:{"is-valid":e.newCombination["corporateFirstValid"],"is-invalid":!e.newCombination["corporateFirstValid"]},attrs:{type:"text",id:"validationServer01",placeholder:"Vorname",required:""},domProps:{value:e.newCombination.corporateFirst},on:{input:[function(t){t.target.composing||e.$set(e.newCombination,"corporateFirst",t.target.value)},function(t){""!=e.newCombination.corporateFirst.length?e.newCombination["corporateFirstValid"]=!0:e.newCombination["corporateFirstValid"]=!1}]}}),a("div",{staticClass:"valid-feedback"},[e._v("Sieht gut aus!")])]),a("div",{staticClass:"col-md-4 mb-3"},[a("label",{attrs:{for:"validationServer02"}},[e._v("Nachname")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newCombination.corporateLast,expression:"newCombination.corporateLast"}],staticClass:"form-control",class:{"is-valid":e.newCombination["corporateLastValid"],"is-invalid":!e.newCombination["corporateLastValid"]},attrs:{type:"text",id:"validationServer02",placeholder:"Nachname",required:""},domProps:{value:e.newCombination.corporateLast},on:{input:[function(t){t.target.composing||e.$set(e.newCombination,"corporateLast",t.target.value)},function(t){""!=e.newCombination.corporateLast.length?e.newCombination["corporateLastValid"]=!0:e.newCombination["corporateLastValid"]=!1}]}}),a("div",{staticClass:"valid-feedback"},[e._v("Sieht gut aus!")])]),a("div",{staticClass:"col-md-4 mb-3"},[a("label",{attrs:{for:"validationServerUsername"}},[e._v("E-Mail")]),a("div",{staticClass:"input-group"},[e._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newCombination.corporatepartnermail,expression:"newCombination.corporatepartnermail"}],staticClass:"form-control",class:{"is-valid":e.newCombination["corporatepartnermailValid"],"is-invalid":!e.newCombination["corporatepartnermailValid"]},attrs:{type:"text",id:"validationServerUsername",placeholder:"E-Mail","aria-describedby":"inputGroupPrepend3",required:""},domProps:{value:e.newCombination.corporatepartnermail},on:{input:[function(t){t.target.composing||e.$set(e.newCombination,"corporatepartnermail",t.target.value)},function(t){e.newCombination.corporatepartnermail.includes("@")?e.newCombination["corporatepartnermailValid"]=!0:e.newCombination["corporatepartnermailValid"]=!1}]}}),a("div",{staticClass:"invalid-feedback"},[e._v("Bitte tragen Sie die E-Mail Ihres Unternehmensbetreuers ein.")])])])]),a("hr"),a("h6",[e._v("Wissenschaftlicher Betreuer")]),a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-md-6 mb-3"},[a("label",{attrs:{for:"supervisors"}},[e._v("Aktueller wiss. Betreuer")]),a("p",[e._v(e._s(e.currentSupervisor))])]),a("div",{staticClass:"col-md-6 mb-3"},[a("label",{attrs:{for:"supervisors"}},[e._v("Neuer wiss. Betreuer")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newCombination.supervisorid,expression:"newCombination.supervisorid"}],staticClass:"form-control form-control-sm mt-2",attrs:{name:"supervisors",id:"supervisors"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newCombination,"supervisorid",t.target.multiple?a:a[0])}}},[a("option",{attrs:{value:"NULL"}}),e._l(e.supervisors,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.firstname)+" "+e._s(t.lastname))])}))],2)])])])])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:e.saveData}},[e._v("Änderungen sichern")]),a("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[e._v("Schließen")])])])])]),a("Infotoast",{ref:"infotoastref",attrs:{message:e.toastmessage}}),a("Docusign",{ref:"docusigner"})],2)},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",[a("th",{attrs:{scope:"col"}},[e._v("Typ")]),a("th",{attrs:{scope:"col"}},[e._v("Deadline")]),a("th",{attrs:{scope:"col"}},[e._v("Abgabe erfolgt")]),a("th",{attrs:{scope:"col"}},[e._v("Betreuerdaten")])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("td",[a("span",{staticClass:"badge badge-success"},[e._v("Erfolgt")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title"},[e._v("Dieser wissenschaftlichen Arbeit zugewiesene Betreuer")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text",attrs:{id:"inputGroupPrepend3"}},[e._v("@")])])}],n=(a("ac1f"),a("5319"),a("bc3a")),r=a.n(n),o=a("1157"),c=a.n(o),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{position:"absolute",bottom:"50px",right:"50px"},attrs:{"aria-live":"polite","aria-atomic":"true"}},[a("div",{staticClass:"toast",attrs:{id:"infotoast","data-autohide":"true","data-delay":"5000"}},[e._m(0),a("div",{staticClass:"toast-body"},[e._v(e._s(e.message))])])])},d=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"toast-header"},[a("strong",{staticClass:"mr-auto"},[e._v("Hinweis")]),a("button",{staticClass:"ml-2 mb-1 close",attrs:{type:"button","data-dismiss":"toast","aria-label":"Close"}})])}],u={name:"Toast",props:{message:String},data:function(){return{}},methods:{open:function(){c()("#infotoast").toast("show")}}},p=u,m=a("2877"),v=Object(m["a"])(p,l,d,!1,null,null,null),h=v.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div")},g=[],b={name:"Docusign",props:{},data:function(){return{toastmessageDocu:"leer"}},components:{},methods:{signApi:function(e){""!=e&&window.open(e,"_blank")}}},w=b,C=Object(m["a"])(w,f,g,!1,null,null,null),_=C.exports,S={name:"Assign",components:{Infotoast:h,Docusign:_},data:function(){return{students:[],showModal:!1,supervisors:[],courses:[],selectedAssignment:"",toastmessage:"",url:"",currentSupervisor:"",currentUserData:{},selectedAssignmentCorpSupervisor:{},corpSupervisorData:[],newCombination:{corporateFirst:"",corporateLast:"",corporatepartnername:"",corporatepartnermail:"",assignid:0,studentid:0,studentname:"",supervisorid:"",supervisorname:""}}},props:{token:{type:String,default:""}},beforeCreate:function(){},mounted:function(){this.getSupervisors(),this.getCourses(),this.getCurrentUserInfo(),this.getCorpSupervisorInfos()},created:function(){},methods:{getCorpSupervisorInfos:function(){var e=this;this.$emit("loading","10%",!1);var t={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"local_spsupman_get_studenthascorpsupervisor",moodlewsrestformat:"json"}},t).then((function(t){e.$emit("loading","90%",!1),t.exception||(e.corpSupervisorData=t.data,e.$emit("loading","100%",!0))})).catch((function(t){console.log(t),e.$emit("loading","100%",!0),e.$emit("ajaxerror")}))},getCurrentUserInfo:function(){var e=this;this.$emit("loading","10%",!1);var t={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"core_webservice_get_site_info",moodlewsrestformat:"json"}},t).then((function(t){e.$emit("loading","90%",!1),t.exception||(e.currentUserData=t.data,e.$emit("loading","100%",!0))})).catch((function(t){console.log(t),e.$emit("loading","100%",!0),e.$emit("ajaxerror")}))},getType:function(e){if(!/\b.*Abgabe PA \d\b/.test(e))return"Ungültige Angabe";switch(e.substr(-1)){case"1":return"PA I";case"2":return"PA II";case"3":return"PA III";default:return"Ungültige Angabe"}},signature:function(e,t){var a=this;this.$emit("loading","10%",!1);var s={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"mod_assign_get_submissions",moodlewsrestformat:"json","assignmentids[0]":this.selectedAssignment}},s).then((function(s){a.$emit("loading","90%",!1);var i="";if(!s.exception&&1==s.data.assignments.length){for(var n=0;n<s.data.assignments[0].submissions.length;n++){var r=s.data.assignments[0].submissions[n];if(r.userid==t)for(var o=0;o<r.plugins.length;o++){var c=r.plugins[o];if("file"==c.type&&1==c.fileareas.length&&1==c.fileareas[0].files.length){var l=c.fileareas[0].files[0].fileurl,d=l.replace("webservice/","");i=d}}}""!=i?a.$refs.docusigner.signApi(i):(e.target.innerHTML="n.A.",e.target.disabled=!0),a.$emit("loading","100%",!0)}})).catch((function(e){console.log(e),a.$emit("loading","100%",!0),a.$emit("ajaxerror")}))},getSupervisorNameById:function(e){for(var t="Not found",a=0;a<this.supervisors.length;a++){var s=this.supervisors[a];s.id==e&&(t=s.firstname+" "+s.lastname)}return t},saveData:function(){var e=this;this.newCombination.assignid=this.selectedAssignment,this.newCombination.studentid=this.currentUserData.userid,this.newCombination.studentname=this.currentUserData.fullname,this.newCombination.corporatepartnername=this.newCombination.corporateFirst+" "+this.newCombination.corporateLast,this.newCombination.supervisorname=this.getSupervisorNameById(this.newCombination.supervisorid);var t={changes:[this.newCombination]},a={variables:{dbchanges:{value:JSON.stringify(t),type:"String"}}};this.$emit("loading","10%",!1),r.a.post((Object({NODE_ENV:"production",VUE_APP_MOODEL_URL:"https://scientific-paper.swimdhbw.de/",BASE_URL:"/mod/spams/static/"}).VUE_APP_CAMUNDA_URL||"https://camunda.scientific-paper.swimdhbw.de/")+"engine-rest/process-definition/key/signing_ceremony/start",a,{headers:{"Content-type":"application/json"}}).then((function(t){e.$emit("loading","100%",!0),200==t.status?e.toastmessage="Die Zuordnung wurde erfolgreich angefordert.":e.toastmessage="Bei der Anforderung der Zuordnung ist ein Fehler aufgetreten.",e.$refs.infotoastref.open()}))},mapSupervisorName:function(e){for(var t="",a=0;a<this.supervisors.length;a++)this.supervisors[a].id==e&&(t=this.supervisors[a].firstname+" "+this.supervisors[a].lastname);return t},changeData:function(e){var t=this,a=e.course;this.selectedAssignment=e.id,this.$emit("loading","10%",!1),this.students=[];var s={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"core_enrol_get_enrolled_users",moodlewsrestformat:"json",courseid:a}},s).then((function(e){e.exception||(t.students=t.filterStudents(e.data),r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:t.token,wsfunction:"local_spsupman_get_studenthassupervisor",moodlewsrestformat:"json"}},s).then((function(e){if(!e.exception){for(var a=0;a<e.data.length;a++)for(var s=0;s<t.students.length;s++)t.students[s].id==e.data[a].studentid&&e.data[a].assignmentid==t.selectedAssignment&&(t.currentSupervisor=t.mapSupervisorName(e.data[a].supervisorid));for(var i=0;i<t.corpSupervisorData.length;i++)t.corpSupervisorData[i].assignmentid==t.selectedAssignment&&(t.newCombination.corporatepartnermail=t.corpSupervisorData[i].cpsupervisormail,t.newCombination.corporatepartnermailValid=!0,t.newCombination.corporateLast=t.corpSupervisorData[i].cpsupervisorlast,t.newCombination.corporateLastValid=!0,t.newCombination.corporateFirst=t.corpSupervisorData[i].cpsupervisorfirst,t.newCombination.corporateFirstValid=!0);c()("#modalStudents").modal("show"),t.$emit("loading","100%",!0)}})).catch((function(e){console.log(e),t.$emit("loading","100%",!0),t.$emit("ajaxerror")})))})).catch((function(e){console.log(e),t.$emit("loading","100%",!0),t.$emit("ajaxerror")}))},getSupervisors:function(){var e=this;this.$emit("loading","10%",!1),this.supervisors=[];var t={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"local_spsupman_get_supervisors",moodlewsrestformat:"json"}},t).then((function(t){t.data.exception?(e.$emit("loading","100%",!0),e.$emit("ajaxerror")):(e.supervisors=t.data,e.$emit("loading","100%",!0))})).catch((function(t){console.log(t),e.$emit("loading","100%",!0),e.$emit("ajaxerror")}))},filterStudents:function(e){for(var t=[],a=0;a<e.length;a++){for(var s=!1,i=0;i<e[a].roles.length;i++)5==e[a].roles[i].roleid&&(s=!0);s&&(e[a].currentSupervisor="",e[a].changed=!1,e[a].newSupervisor="",t.push(e[a]))}return t},getCourses:function(){var e=this;this.$emit("loading","10%",!1);var t={headers:{"Content-Type":"application/json;charset=UTF-8"}};r.a.get("https://scientific-paper.swimdhbw.de//webservice/rest/server.php",{params:{wstoken:this.token,wsfunction:"mod_assign_get_assignments",moodlewsrestformat:"json"}},t).then((function(t){e.$emit("loading","100%",!0),t.exception||(e.courses=t.data.courses)})).catch((function(t){e.$emit("loading","100%",!0),e.$emit("ajaxerror"),console.log(t)}))}}},$=S,y=Object(m["a"])($,s,i,!1,null,null,null);t["default"]=y.exports}}]);
//# sourceMappingURL=chunk-ee6c01e4.9b6c1717.js.map